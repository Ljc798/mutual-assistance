<!-- å°çƒï¼šåªæŒ‚ touch äº‹ä»¶ï¼Œä¸ç”¨ bindtap -->
<view class="ai-ball" style="left: {{ballPosition.x}}px; top: {{ballPosition.y}}px;" catchtouchstart="onTouchStart" catchtouchmove="onTouchMove" catchtouchend="onTouchEnd">
    <text class="ai-ball-icon">ğŸ¤–</text>
</view>

<view class="chat-popup" wx:if="{{showChatPopup}}">
    <view class="chat-mask" bindtap="closeChatPopup"></view>
    <view class="chat-content">
        <view class="chat-header">
            <view class="chat-title">å…¨èƒ½AIåŠ©æ‰‹</view>
            <text class="chat-subtitle">AIç”Ÿæˆï¼Œè¯·è‡ªè¡Œç”„åˆ«</text>
        </view>

        <scroll-view class="chat-messages" scroll-y scroll-into-view="{{scrollIntoView}}" scroll-with-animation>
            <view wx:for="{{chatMessages}}" wx:key="index" class="message {{item.type}}" id="{{index === chatMessages.length - 1 ? 'last-message' : ''}}">
                <view class="message-content">{{item.content}}</view>
                <view class="message-time">{{item.timestamp}}</view>
            </view>

            <view wx:if="{{isLoading}}" class="message ai" id="last-message">
                <view class="loading-dots">
                    <view class="loading-dot"></view>
                    <view class="loading-dot"></view>
                    <view class="loading-dot"></view>
                </view>
            </view>
        </scroll-view>

        <view class="usage-info">
            <text wx:if="{{limit === -1}}">ğŸ’ æ— é™æ¬¡å¯¹è¯ç‰¹æƒå·²å¼€å¯</text>
            <text wx:elif="{{remaining >= 0}}">ğŸ’¬ ä»Šæ—¥å‰©ä½™ {{remaining}} / {{limit}} æ¬¡</text>
            <text class="quota" wx:if="{{limit !== -1 && !isSVIP && quotaRemain > 0}}">ğŸŸï¸ é¢å¤–é¢åº¦ {{quotaRemain}} æ¬¡</text>
        </view>
        <view class="chat-input-container">
            <!-- æ³¨æ„ï¼štextarea åœ¨ WXML é‡Œä¸è¦è‡ªé—­åˆï¼Œç”¨æ˜¾å¼ç»“æŸæ ‡ç­¾ -->
            <textarea class="chat-input" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." value="{{chatInput}}" bindinput="handleChatInput" auto-height maxlength="500"></textarea>
            <button class="send-button" bindtap="sendChatMessage" disabled="{{isLoading}}">{{isLoading ? 'å‘é€ä¸­...' : 'å‘é€'}}</button>
        </view>
    </view>
</view>