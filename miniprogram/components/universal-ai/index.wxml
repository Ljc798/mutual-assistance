<!--components/universal-ai/index.wxml-->
<view class="ai-ball" style="left: {{ballPosition.x}}px; top: {{ballPosition.y}}px;" catchtouchstart="onTouchStart" catchtouchmove="onTouchMove" catchtouchend="onTouchEnd" bindtap="onBallTap">
  <text class="ai-ball-icon">ğŸ¤–</text>
</view>

<view class="chat-popup" wx:if="{{showChatPopup}}">
  <view class="chat-mask" bindtap="closeChatPopup"></view>
  <view class="chat-content">
    <view class="chat-header">
      <view class="chat-title">å…¨èƒ½AIåŠ©æ‰‹</view>
      <text class="chat-close" bindtap="closeChatPopup">Ã—</text>
    </view>

    <scroll-view class="chat-messages" scroll-y="true" scroll-into-view="{{scrollIntoView}}" scroll-with-animation="true">
      <view wx:for="{{chatMessages}}" wx:key="index" class="message {{item.type}}" id="{{index === chatMessages.length - 1 ? 'last-message' : ''}}">
        <view class="message-content">{{item.content}}</view>
        <view class="message-time">{{item.timestamp}}</view>
      </view>

      <view wx:if="{{isLoading}}" class="message ai" id="last-message">
        <view class="loading-dots">
          <view class="loading-dot">Â·</view>
          <view class="loading-dot">Â·</view>
          <view class="loading-dot">Â·</view>
        </view>
      </view>
    </scroll-view>

    <view class="chat-input-container">
      <textarea class="chat-input" placeholder="è¯´ç‚¹ä»€ä¹ˆ..." value="{{chatInput}}" bindinput="handleChatInput" auto-height maxlength="500" />
      <button class="send-button" bindtap="sendChatMessage" disabled="{{isLoading}}">{{isLoading ? 'å‘é€ä¸­...' : 'å‘é€'}}</button>
    </view>
  </view>
</view>