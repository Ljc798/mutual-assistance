<view class="user-container">
    <notify-banner />
    <view class="header">
        <view class="app-name">æˆ‘çš„ä¿¡æ¯</view>
    </view>

    <!-- ä¸ªäººä¿¡æ¯åŒºåŸŸ -->
    <view class="user-info" bindtap="goToEditProfile">
        <view class="avatar">
            <image src="{{userInfo.avatar_url}}" class="avatar-img" mode="aspectFill" />
        </view>

        <view class="info">
            <text class="user-name">{{userInfo && userInfo.username ? userInfo.username : 'ç«‹å³ç™»å½•'}}</text>
            <text class="user-id">{{userInfo && userInfo.wxid ? 'ID: ' + userInfo.wxid : 'ç™»å½•ä»¥ä½“éªŒå®Œæ•´åŠŸèƒ½'}}</text>
        </view>

        <view class="arrow">
            <image src="/assets/icons/right-chevron-svgrepo-com.svg" class="arrow-icon" />
        </view>
    </view>

    <view class="credit-badge" bindtap="goToReputation">
        <image class="star-icon" src="/assets/icons/star-1-svgrepo-com.svg"></image>
        <text class="credit-text">ä¿¡èª‰ {{userInfo.credit_score || 80}}åˆ†</text>
        <text class="credit-level">{{creditLevel}}</text>

        <view class="stars">
            <block wx:for="{{5}}" wx:key="*this">
                <image class="star-small" src="{{index < starCount ? '/assets/icons/star-fill.svg' : '/assets/icons/star-empty.svg'}}" />
            </block>
        </view>
    </view>

    <!-- å…è´¹æ¬¡æ•°å’Œé’±åŒ…ä½™é¢ -->
    <view class="info-box">
        <view class="box" bindtap="goToShop">
            <text class="label">å…ä½£é‡‘æ¬¡æ•°</text>
            <text class="value">{{userInfo.free_counts}}</text>
        </view>
        <view class="box" bindtap="goToShop">
            <text class="label">ç§¯åˆ†ä½™é¢</text>
            <text class="value">{{userInfo.points}}</text>
        </view>
        <view class="box" bindtap="goToWallet">
            <text class="label">è´¦æˆ·ä½™é¢</text>
            <text class="value">{{userInfo.balance}}</text>
        </view>
    </view>

    <view class="vip-card" wx:if="{{isVip}}">
        <image class="vip-badge" src="/assets/icons/huiyuanVIP.svg" />
        <view class="vip-info">
            <text class="vip-label">VIP ç”¨æˆ·</text>
            <text class="vip-expire">åˆ°æœŸæ—¶é—´ï¼š{{vip_expire_time}}</text>
        </view>
        <button class="vip-renew-btn" size="mini" bindtap="goToVipPage">ç»­ è´¹</button>
    </view>

    <!-- é VIP å±•ç¤ºæ™®é€šç›’å­ -->
    <view class="vip-box" wx:else>
        <view class="vip-status">
            <image src="/assets/icons/huiyuanVIP-2.svg" class="vip-icon" />
            <text>å½“å‰ä¸æ˜¯ VIP ç”¨æˆ·</text>
        </view>
        <button class="vip-btn" size="mini" bindtap="goToVipPage">ç«‹å³å¼€é€š</button>
    </view>
    <!-- æˆ‘çš„è®¢å•ï¼Œæˆ‘çš„ç©ºé—´ï¼Œæ„è§åé¦ˆ -->
    <view class="action-box">
        <view class="action-item" bindtap="handleOrderClick">
            <text>æˆ‘çš„è®¢å•</text>
        </view>
        <view class="action-item" bindtap="handleSpaceClick">
            <text>æˆ‘çš„ç©ºé—´</text>
        </view>
        <view class="action-item" bindtap="goToShop">
            <text>å•†åŸ</text>
        </view>
        <view class="action-item" bindtap="onFeedbackClick">
            <text>æ„è§åé¦ˆ</text>
        </view>
        <view style="text-align: center; font-weight: 400; color: #333;">
            <text>æ‚¨çš„æ„è§çœŸçš„çœŸçš„å¯¹æˆ‘ä»¬å¾ˆé‡è¦ğŸ¥º</text>
        </view>
    </view>

    <!-- æ„è§åé¦ˆå¼¹çª— -->
    <view class="feedback-popup" wx:if="{{showFeedbackPopup}}">
        <view class="popup-content">
            <text class="popup-title">æ„è§åé¦ˆ</text>
            <input class="popup-input" placeholder="æ ‡é¢˜" value="{{feedbackTitle}}" bindinput="onFeedbackTitleInput" />
            <textarea class="popup-textarea" placeholder="è¯·å†™ä¸‹æ‚¨çš„åé¦ˆ..." value="{{feedbackContent}}" bindinput="onFeedbackContentInput" />

            <view class="popup-actions">
                <button class="cancel-btn" bindtap="closeFeedbackPopup">å–æ¶ˆ</button>
                <button class="submit-btn" bindtap="submitFeedback">æäº¤</button>
            </view>
        </view>
    </view>

    <!-- åº•éƒ¨å¯¼èˆªæ  -->
</view>
<bottom-nav></bottom-nav>